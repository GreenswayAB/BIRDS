<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with xts time series • BIRDS</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with xts time series">
<meta property="og:description" content="BIRDS">
<meta property="og:image" content="/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-147720899-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-147720899-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BIRDS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/BIRDS.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Documents
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/technical_details.html">BIRDS technical details</a>
    </li>
    <li>
      <a href="../articles/working_with_xts_timeseries.html">Working with xts time series</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/greensway/BIRDS">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="working_with_xts_timeseries_files/header-attrs-2.4/header-attrs.js"></script><script src="working_with_xts_timeseries_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with xts time series</h1>
                        <h4 class="author">Alejandro Ruete</h4>
            
            <h4 class="date">2020-10-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/Greensway/BIRDS/blob/master/vignettes/working_with_xts_timeseries.Rmd"><code>vignettes/working_with_xts_timeseries.Rmd</code></a></small>
      <div class="hidden name"><code>working_with_xts_timeseries.Rmd</code></div>

    </div>

    
    
<p>This vignette is adapted from <a href="https://rpubs.com/RLodge/timeseriesintro" class="uri">https://rpubs.com/RLodge/timeseriesintro</a></p>
<div id="xts-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#xts-objects" class="anchor"></a>xts Objects</h2>
<p>One of the objects that comes out of the <code><a href="../reference/summarizeBirds.html">summariseBirds()</a></code> function is <code>$temporal</code>, a <code>xts</code> object. A <code>xts</code> is a time series (a series of data points in chronological order, where time is the independent variable). The ‘x’ in xts stands for extensible, because it is an extension of <code>zoo</code> (another package). An <code>xts</code> object is formed just as a <code>zoo</code> object is. However, an <code>xts</code> object is in matrix form and thus is easier to subset through.</p>
<p>If we start from the basic example</p>
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/greensway/BIRDS">BIRDS</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/joshuaulrich/xts">xts</a></span><span class="op">)</span>
<span class="co"># Create a grid for your sample area that will be used to summarise the data:</span>
<span class="va">grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeGrid.html">makeGrid</a></span><span class="op">(</span><span class="va">gotaland</span>, gridSize <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>
<span class="co"># The grid can be easily created in different ways. </span>

<span class="co"># Import the species observation data:</span>
<span class="va">PBD</span> <span class="op">&lt;-</span> <span class="va">bombusObs</span>
<span class="co"># alternatively, you could load a previously downloaded .CSV file </span>
<span class="co"># PBD &lt;- read.csv(file="path/to/your/file.csv)</span>

<span class="co"># Convert the data from an observation-based to a visit-based format, </span>
<span class="co"># adding a unique identifier for each visit:</span>
<span class="va">OB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/organizeBirds.html">organizeBirds</a></span><span class="op">(</span><span class="va">PBD</span>, sppCol <span class="op">=</span> <span class="st">"scientificName"</span>, simplifySppName <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Summarise the data:</span>
<span class="va">SB</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarizeBirds.html">summariseBirds</a></span><span class="op">(</span><span class="va">OB</span>, grid<span class="op">=</span><span class="va">grid</span><span class="op">)</span></pre></div>
<p>we see that SB contains an element called <code>SB$temporal</code> that contains a daily time series with time specific rows when there is information. <code>xts</code> also supports time, but dating below day resolution is not yet implemented in the <code>BIRDS</code> package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="va">sb.xts</span><span class="op">&lt;-</span><span class="va">SB</span><span class="op">$</span><span class="va">temporal</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">sb.xts</span><span class="op">)</span>
<span class="co">#&gt;            nObs nVis nSpp</span>
<span class="co">#&gt; 2000-04-21    1    1    1</span>
<span class="co">#&gt; 2000-04-24    1    1    1</span>
<span class="co">#&gt; 2000-04-25    9    5    6</span>
<span class="co">#&gt; 2000-04-26    7    4    5</span>
<span class="co">#&gt; 2000-05-05    1    1    1</span>
<span class="co">#&gt; 2000-05-28    3    2    3</span>
<span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">sb.xts</span><span class="op">)</span>
<span class="co">#&gt; [1] 1734    3</span></pre></div>
<p>Sub-setting is convenient in <code>xts</code> as you can do it with its dates and with a <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code> for a range of dates.</p>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="va">sb.xts</span><span class="op">[</span><span class="st">"2017-09"</span><span class="op">]</span> <span class="co">#a specific month</span>
<span class="co">#&gt;            nObs nVis nSpp</span>
<span class="co">#&gt; 2017-09-01    1    1    1</span>
<span class="co">#&gt; 2017-09-03    2    2    2</span>
<span class="co">#&gt; 2017-09-07    1    1    1</span>
<span class="co">#&gt; 2017-09-09    1    1    1</span>
<span class="co">#&gt; 2017-09-12    1    1    1</span>
<span class="co">#&gt; 2017-09-19    4    2    4</span>
<span class="va">sb.xts</span><span class="op">[</span><span class="st">"2017-09-07"</span><span class="op">]</span> <span class="co">#a specific day</span>
<span class="co">#&gt;            nObs nVis nSpp</span>
<span class="co">#&gt; 2017-09-07    1    1    1</span>
<span class="va">sb.xts</span><span class="op">[</span><span class="st">"2017-01-01/2017-05-01"</span><span class="op">]</span> <span class="co">#for a period</span>
<span class="co">#&gt;            nObs nVis nSpp</span>
<span class="co">#&gt; 2017-03-10    1    1    1</span>
<span class="co">#&gt; 2017-03-22    1    1    1</span>
<span class="co">#&gt; 2017-03-23    2    2    2</span>
<span class="co">#&gt; 2017-03-24    2    2    2</span>
<span class="co">#&gt; 2017-03-25    5    5    3</span>
<span class="co">#&gt; 2017-03-26    6    6    4</span>
<span class="co">#&gt; 2017-03-27    1    1    1</span>
<span class="co">#&gt; 2017-03-28    2    2    2</span>
<span class="co">#&gt; 2017-03-31    3    3    2</span>
<span class="co">#&gt; 2017-04-01    5    5    4</span>
<span class="co">#&gt; 2017-04-02    8    8    3</span>
<span class="co">#&gt; 2017-04-03    6    6    4</span>
<span class="co">#&gt; 2017-04-04    1    1    1</span>
<span class="co">#&gt; 2017-04-05    1    1    1</span>
<span class="co">#&gt; 2017-04-06    2    2    2</span>
<span class="co">#&gt; 2017-04-07    3    3    2</span>
<span class="co">#&gt; 2017-04-08    3    3    2</span>
<span class="co">#&gt; 2017-04-09    9    9    5</span>
<span class="co">#&gt; 2017-04-11    6    6    4</span>
<span class="co">#&gt; 2017-04-12    1    1    1</span>
<span class="co">#&gt; 2017-04-14    5    5    4</span>
<span class="co">#&gt; 2017-04-16    2    2    1</span>
<span class="co">#&gt; 2017-04-19    2    2    2</span>
<span class="co">#&gt; 2017-04-21    1    1    1</span>
<span class="co">#&gt; 2017-04-22    3    3    3</span>
<span class="co">#&gt; 2017-04-23    3    3    2</span>
<span class="co">#&gt; 2017-04-26    3    3    3</span>
<span class="co">#&gt; 2017-04-29    5    5    4</span>
<span class="co">#&gt; 2017-04-30   12   11    6</span>
<span class="co">#&gt; 2017-05-01    4    3    2</span></pre></div>
<p><code>xts</code> has several tools for converting to different periods. Here we will use <code>to.monthly</code>. This provides, the first, min, max, and last of the data. We can plot the daily maximum number of observations. The plot command with an <code>xts</code> object provides a TON of features. This makes it fairly easy to customize your plots. Read more in <code><a href="https://rdrr.io/pkg/xts/man/plot.xts.html">?plot.xts</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="va">obs.m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/to.period.html">to.monthly</a></span><span class="op">(</span><span class="va">sb.xts</span><span class="op">$</span><span class="va">nObs</span><span class="op">)</span> 
<span class="va">obs.m</span><span class="op">[</span><span class="st">"2017-04"</span><span class="op">]</span>
<span class="co">#&gt;          sb.xts$nObs.Open sb.xts$nObs.High sb.xts$nObs.Low sb.xts$nObs.Close</span>
<span class="co">#&gt; Apr 2017                5               12               1                12</span>
<span class="va">sb.xts</span><span class="op">[</span><span class="st">"2017-04"</span><span class="op">]</span>
<span class="co">#&gt;            nObs nVis nSpp</span>
<span class="co">#&gt; 2017-04-01    5    5    4</span>
<span class="co">#&gt; 2017-04-02    8    8    3</span>
<span class="co">#&gt; 2017-04-03    6    6    4</span>
<span class="co">#&gt; 2017-04-04    1    1    1</span>
<span class="co">#&gt; 2017-04-05    1    1    1</span>
<span class="co">#&gt; 2017-04-06    2    2    2</span>
<span class="co">#&gt; 2017-04-07    3    3    2</span>
<span class="co">#&gt; 2017-04-08    3    3    2</span>
<span class="co">#&gt; 2017-04-09    9    9    5</span>
<span class="co">#&gt; 2017-04-11    6    6    4</span>
<span class="co">#&gt; 2017-04-12    1    1    1</span>
<span class="co">#&gt; 2017-04-14    5    5    4</span>
<span class="co">#&gt; 2017-04-16    2    2    1</span>
<span class="co">#&gt; 2017-04-19    2    2    2</span>
<span class="co">#&gt; 2017-04-21    1    1    1</span>
<span class="co">#&gt; 2017-04-22    3    3    3</span>
<span class="co">#&gt; 2017-04-23    3    3    2</span>
<span class="co">#&gt; 2017-04-26    3    3    3</span>
<span class="co">#&gt; 2017-04-29    5    5    4</span>
<span class="co">#&gt; 2017-04-30   12   11    6</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">obs.m</span><span class="op">[</span><span class="st">"2010/2017"</span>,<span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, grid.ticks.on <span class="op">=</span> <span class="st">"month"</span>,   major.ticks <span class="op">=</span> <span class="st">"month"</span>, grid.col <span class="op">=</span> <span class="st">"lightgrey"</span>,  main <span class="op">=</span> <span class="st">"Maximum number of daily observations per month"</span><span class="op">)</span></pre></div>
<p><img src="working_with_xts_timeseries_files/figure-html/monthly%20and%20plot-1.png" width="864"></p>
<p>Only months with data are plotted in this figure. What if we want to complete the time series and plot all zeros too? in the original time series there is not data for every day, therefore the time series is incomplete.</p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="co"># sb.xts.na is same as sb.xts but with all missing days added (with NAs)</span>
<span class="va">rng</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html">time</a></span><span class="op">(</span><span class="va">sb.xts</span><span class="op">)</span><span class="op">)</span>
<span class="va">sb.xts.na</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/merge.html">merge</a></span><span class="op">(</span><span class="va">sb.xts</span>, <span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">rng</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></pre></div>
<p>However, in our monthly example we may not need data for every day, but month, and this time we need 0s instead of NAs. Even more, we don’t want to add zeros for the months we already have data, because that will change the summary statistics. Then we add 0s for the months we have no data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="va">z.seq</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="va">rng</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">rng</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, by <span class="op">=</span> <span class="st">"month"</span><span class="op">)</span>
<span class="va">YM.sb.xts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">as.yearmon</span><span class="op">(</span><span class="fu">index</span><span class="op">(</span><span class="va">sb.xts</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">YM.z.seq</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="fu">as.yearmon</span><span class="op">(</span><span class="va">z.seq</span><span class="op">)</span><span class="op">)</span>
<span class="va">wTrm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html">which</a></span><span class="op">(</span><span class="va">YM.z.seq</span> <span class="op">%in%</span> <span class="va">YM.sb.xts</span><span class="op">)</span>
<span class="va">z.seq</span> <span class="op">&lt;-</span> <span class="va">z.seq</span><span class="op">[</span><span class="op">-</span><span class="va">wTrm</span><span class="op">]</span> <span class="co">## remove the days for which </span>

<span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/xts.html">xts</a></span><span class="op">(</span>, <span class="va">z.seq</span><span class="op">)</span>

<span class="va">sb.xts.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/sp/man/merge.html">merge</a></span><span class="op">(</span><span class="va">sb.xts</span>, <span class="va">z</span>, fill <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>

<span class="va">obs.m.0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/xts/man/to.period.html">to.monthly</a></span><span class="op">(</span><span class="va">sb.xts.0</span><span class="op">$</span><span class="va">nObs</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">obs.m.0</span><span class="op">[</span><span class="st">"2010/2017"</span>,<span class="fl">2</span><span class="op">]</span>, col <span class="op">=</span> <span class="st">"darkblue"</span>, grid.ticks.on <span class="op">=</span> <span class="st">"month"</span>,   major.ticks <span class="op">=</span> <span class="st">"month"</span>, grid.col <span class="op">=</span> <span class="st">"lightgrey"</span>,  main <span class="op">=</span> <span class="st">"Maximum number of daily observations per month"</span><span class="op">)</span></pre></div>
<p><img src="working_with_xts_timeseries_files/figure-html/completting2-1.png" width="864"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Debora Arlt, Alejandro Ruete, Anton Hammarström.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
